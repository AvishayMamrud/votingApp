@startuml
hide circle
skinparam linetype ortho
skinparam classAttributeIconSize 0

' Core entities
entity "Survey" as Survey {
  *id : UUID <<PK>>
  --
  title : varchar
  description : text
  owner_id : UUID
  expires_at : datetime
  created_at : datetime
  updated_at : datetime
}

entity "Question" as Question {
  *id : UUID <<PK>>
  --
  survey_id : UUID <<FK>>
  question_text : text
  question_type : enum
  sort_order : int
  created_at : datetime
}

entity "Option" as Option {
  *id : UUID <<PK>>
  --
  question_id : UUID <<FK>>
  option_text : varchar
  sort_order : int
  created_at : datetime
}

entity "SurveyTag" as SurveyTag {
  survey_id : UUID <<FK>>
  tag : varchar
}

' Access Control Tables
entity "SurveyPublicAccess" as SurveyPublicAccess {
  *survey_id : UUID <<PK>>
}

entity "SurveyUserAccess" as SurveyUserAccess {
  *id : UUID <<PK>>
  --
  survey_id : UUID <<FK>>
  user_id : UUID
}

entity "SurveyGroupAccess" as SurveyGroupAccess {
  *id : UUID <<PK>>
  --
  survey_id : UUID <<FK>>
  group_id : UUID
}

entity "SurveyRoleAccess" as SurveyRoleAccess {
  *id : UUID <<PK>>
  --
  survey_id : UUID <<FK>>
  role_name : varchar
}

' Group infrastructure (optional for completeness)
entity "Group" as Group {
  *id : UUID <<PK>>
  name : varchar
}

entity "GroupMember" as GroupMember {
  *group_id : UUID <<FK>>
  *user_id : UUID <<FK>>
}

' External reference
entity "User" as User {
  *id : UUID <<PK>>
  --
  -- External service reference only
}

' Relationships
User ||--o{ Survey : owns
Survey ||--o{ Question : contains
Question ||--o{ Option : has
Survey ||--o{ SurveyTag : tagged_with

Survey ||--|| SurveyPublicAccess : "public"
Survey ||--o{ SurveyUserAccess : "shared with users"
Survey ||--o{ SurveyGroupAccess : "shared with groups"
Survey ||--o{ SurveyRoleAccess : "shared with roles"

Group ||--o{ GroupMember : has
User ||--o{ GroupMember : member of

@enduml